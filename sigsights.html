<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fastly SigSights - Hulu</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script src="https://cdn.plot.ly/plotly-2.20.0.min.js" charset="utf-8"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link rel="stylesheet" href="static/css/style.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="sigsights-utils.js"></script>
    <script>

        function showAttackChart(d) {
            var data = [{
                values: [6835283, 692194, 238587],
                labels: ['United States', 'Private Network', 'Italy'],
                type: 'pie',
                textinfo: "label+percent"
            }];

            var layout = {
                showlegend: false,
                fontsize: 12
            };

            var config = {responsive: true}

            Plotly.newPlot('globalAttackChartContainer', data, layout, config);




            var chart = new CanvasJS.Chart("chartContainer", {
                theme: "light2",
                animationEnabled: false,
                data: [{
                    type: "pie",
                    startAngle: 90,
                    toolTipContent: "<b>{countryName}</b>: {requestCount}",
                    legendText: "{countryCode}",
                    indexLabelFontSize: 12,
                    indexLabel: "{countryName}",
                    dataPoints: d
                }]
            });
            chart.render();
        }

        function showAllRequestsChart(d) {
            
            for (type in d) {
                if (d[type].type == "requests_total") {
                    totalRequestsData = meltRequestData(d[type])
                }
                if (d[type].type == "requests_attack") {
                    totalAttacksData = meltRequestData(d[type])
                }
                if (d[type].type == "requests_total_blocked") {
                    totalBlockedData = meltRequestData(d[type]);
                }
            }

            var chart = new CanvasJS.Chart("allRequestsChart", {
                axisY:{
                    title: "Attack and Blocked Requests",
                    includeZero: false,
                    suffix: "M",
                    labelFontSize: 12,
                    titleFontSize: 16
                },
                axisY2:{
                    title: "All Requests",
                    includeZero: false,
                    suffix: "M",
                    labelFontSize: 12,
                    titleFontSize: 16
                },
                axisX: {
                    valueFormatString: "MM/DD",
                    labelFontSize: 12,
                    titleFontSize: 16
                },
                toolTip: {
                    shared: true
                },
                legend: {
                    fontSize: 16
                },
                data: [{
                    type:"line",
                    axisYType: "secondary",
                    name: "Total Requests",
                    axisY2Index: 0,
                    showInLegend: true,
                    markerSize: 0,
                    dataPoints: totalRequestsData
                },
                {
                    type: "line",
                    name: "Attack Requests",
                    showInLegend: true,
                    axisYIndex: 1,
                    markerSize: 0,
                    dataPoints: totalAttacksData
                },
                {
                    type: "line",
                    name: "Blocked Requests",
                    showInLegend: true,
                    axisYIndex: 1,
                    markerSize: 0,
                    dataPoints: totalBlockedData
                }]
            });
            chart.render();

        }

        function meltRequestData(d) {
    
            var from = d.from;
            var until = d.until;
            var inc = d.inc;
            var recordCount = (d.until - d.from) / d.inc
            var meltedData = []

            for (day in d.data) {
                meltedData.push({
                    x: new Date((from * 1000) + (86400 * 1000 * day)),
                    y: d.data[day] / 1000000
                })
            }
            console.log(meltedData);
            return meltedData;
        }

        function toogleDataSeries(e){
            if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                e.dataSeries.visible = false;
            } else{
                e.dataSeries.visible = true;
            }
            chart.render();
        }


        $("document").ready(function(){

            //corp = prompt("Corp:", "hulu");
            corp = "hulu";
            HEADERS = {
                    "Authorization": "Bearer 6e77aa3a-fd42-4938-bed6-500737719b15",
                    "Content-Type": "application/json"
                }
            
            // basically just get corp display name
            $.ajax({
                "url" : "https://dashboard.signalsciences.net/api/v0/corps/" + corp,
                "method": "GET",
                "headers": HEADERS
                }).done(function (response) {
                    $("#corp-overview-header").html(response.displayName + ' Corp Overview');
                    $("#toc-list").append('<li><a href="#">' + response.displayName + ' Corp Overview</a></li>');
                })

            // get a list of all sites
            $.ajax({
                "url" : "https://dashboard.signalsciences.net/api/v0/corps/" + corp + "/sites",
                "method": "GET",
                "headers": HEADERS
                }).done(function (response) {
                    $.each(response.data, function(i, obj) {
                        $("#toc-list").append('<li><a href="#">' + obj.displayName + '</a></li>');
                    });
                });
            
            // get attack data (this is by site)
            $.ajax({
                "url": "https://dashboard.signalsciences.net/api/v0/corps/" + corp + "/reports/attacks",  
                "method": "GET",
                "headers": HEADERS
                }).done(function (response) {
                    console.log(response.data);
                    attackData = compressAttackData(response.data);

                    $.each(attackData, function(i, row) {
                        $("#attacks-table").append('<tr><td>'+row.countryName+'</td><td>'+row.countryCode+'</td><td class="numbers">'+row.requestCount.toLocaleString()+'</td></tr>')
                    });
                    showAttackChart(attackData);
                });
            // get timeseries data  
            datenow = Date.now() / 1000|0;
            console.log(datenow);
            minus90d = (datenow - (90 * 24 * 60 * 60));

            $.ajax({
                "url": "https://dashboard.signalsciences.net/api/v0/corps/" + corp + "/timeseries/requests?from=" + minus90d + "&path=requests_total&path=requests_attack&path=requests_total_blocked&until=" + datenow,  
                "method": "GET",
                "headers": HEADERS
                }).done(function (response) {
                    console.log(minus90d + " - " + datenow);
                    console.log(response.data);
                    showAllRequestsChart(response.data);
                });
            });
    
    </script>
  </head>
  <body>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

        <div class="container-fluid">
            <div class="row">
                <div class="col text-center" style="background-color: red; color: white;">
                    <img src="static/img/fastly_logo_white.png" alt="fastly header" class="img-fluid" style="max-width: 300px; margin: 20px 20px 20px 20px;"/>
                    <p>Fastly Next Generation WAF Report</p>
                    <p>Â©2022 Fastly, Inc. | Confidential | <a href="http://www.fastly.com">fastly.com</a></p>
                    <img src="static/img/bg2.png" alt="fastly decorative header" class="img-fluid" style="max-width: 600px; margin-bottom: 20px;"/>
                </div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h1 id="toc">Table of Contents</h1>
                    <ul id="toc-list">
                    </ul>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h1 id="corp-overview-header"></h1>
                    <p>The NGWAF Report provides a high-level view of your Corp and Top Sites which see the most traffic, which sites are attacked the most, which sites are seeing the most blocked traffic and which sites we are identifying the most flagged, malicious IPs for. In addition to high-level stats, the NGWAF Report also provides a view into attack types, and their source, which helps enable your security team to understand better how your services are being attacked and the direction you should take to mitigate them.</p>
                    <div>

                        <h2>Global Attack Sources</h2>

                        <p id="globalAttackChartContainer" style="height: 800px; width: 100%;"></p>
                        <p id="chartContainer" style="height: 800px; width: 100%;"></p>
                        <p>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Country</th>
                                        <th>Country Code</th>
                                        <th class="numbers">Attacks</th>
                                    </tr>
                                </thead> 
                                <tbody id="attacks-table"></tbody>
                            </table>
                        </p>    
                        <p>Attack map, also known as a cyber attack map, is a visual representation of the source and destination country locations around the world generating attack traffic. It is based on real-time application layer security analysis of attack Signals we analyze and identify coming from specific countries over the last 90 days for your corp/sites.</p>
                    </div>
                </div>
                <div class="col"></div>
            </div>
                
            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>All Requests Over the Last 90 Days</h2>
                    <p id="allRequestsChart" style="height: 600px; width: 100%;"></p>
                    <p>This chart shows you the total number of requests over the previous 90 days. Here we can compare the number of attack vs blocked requests compared to the overall number of requests that your entire Corp has handled.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Top Four Sites by Blocked Requests</h2>
                    <p><img src="static/img/top-four-sites-by-blocked-requests.png" alt="Blocked, Flagged IP, and Attack for top 4 sites" class="img-fluid" width="100%"/></p>
                    <p>These are the Top 4 Sites/Workspaces in your Corp that have blocked requests. This will include requests that have been blocked by System Alerts, Request Rules, Rate Limit Rules, and Templated Rules.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Top Attack Signals by Site</h2>
                    <p><img src="static/img/top-attack-signals-by-site.png" alt="Top attack signals grouped by site" class="img-fluid" width="100%"/></p>
                    <p>These are the top sites that have sent the most attack traffic. Attack traffic is considered to be the following signals: CMDEXE, Traversal, Backdoor, Attack Tooling, SQLI, and XSS. The default threshold for these attack signals is 50 in 1 minute. It is recommended to reduce this threshold if the application is extremely vulnerable. In some cases, it might be necessary to block these requests immediately, which can be done with a Request Rule.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Sites with CVE Anomaly Signals</h2>
                    <p><img src="static/img/sites-with-cve-anomaly-signals.png" alt="Sites with CVE Anomaly" class="img-fluid" width="100%"/></p>
                    <p>These sites are seeing the most CVE signals. The CVE Templated Rules should be enabled in order to see data in this graph. It is recommended to turn on CVE rules to virtually patch the applications in your environment. Turning on non-relevant CVE rules is not recommended.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Sites with Login and Registration Signals</h2>
                    <p><img src="static/img/sites-with-login-and-registration-signals.png" alt="login and registration anomalies grouped by site" class="img-fluid" width="100%"/></p>
                    <p>Logins and Registration signals will allow you to see whether account takeover attacks have occurred. If you see a spike in Login Failure vs Success, that could indicate a cred stuffing attempt. It is recommended to turn on as many ATO Templated Rules as possible for visibility.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Sites with Anomaly Signals</h2>
                    <p><img src="static/img/sites-with-anomaly-signals.png" alt="Anomaly signals grouped by site" class="img-fluid" width="100%"/></p>
                    <p>Anomaly Signals indicate an abnormal request, for example, the No Content-Type signal indicates the Content-Type header value is missing. This does not mean the request is an attack, but something that may need attention.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Sites with Corp Signals</h2>
                    <p><img src="static/img/sites-with-corp-signals.png" alt="corp signals grouped by signal" class="img-fluid" width="100%"/></p>
                    <p>Corp Signals are signals created by individual users that have access to the NGWAF. These custom signals can be used in a Request Rule to identify requests with request header or body values.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Single Sign On is enabled - <a href=""/>Single Sign On options</a></h2>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Inactive User Accounts</h2>
                    <p>Increase account security by removing access for all inactive users.</p>
                    <p>In order to avoid unnecessary access to the sensitive information on your NGWAF, it's best to audit the users that have access to the application, but haven't logged in yet. For those who may not need access to the product, it is recommended to remove their access.</p>
                    <div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                </tr>
                            </thead>  
                            <tbody> 
                                <tr>
                                    <td>yaqoub.hajir@disneystreaming.com</td>
                                    <td>user</td>
                                    <td>pending</td>
                                </tr>
                                <tr>
                                    <td>carl.hudson@disneystreaming.com</td>
                                    <td>user</td>
                                    <td>pending</td>
                                </tr>
                                <tr>
                                    <td>brock.davis@disneystreaming.com</td>
                                    <td>user</td>
                                    <td>pending</td>
                                </tr>
                                <tr>
                                    <td>troy.lambert@disneystreaming.com</td>
                                    <td>observer</td>
                                    <td>pending</td>
                                </tr>
                                <tr>
                                    <td>terrance.mccoy@disneystreaming.com</td>
                                    <td>observer</td>
                                    <td>pending</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Corp Allow Rules</h2>
                    <p>Please review any Corp 'Allow' Rules as they take precedence</p>
                    <p>Allow rules permit traffic that is explicitly allowed. Allow rules take precedence over block rules, regardless of whether they were created at the corp or site level. <a href="">Allow/Block Precedence</a></p>
                    <div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th width="140px">Site Names</th>
                                    <th>Enabled</th>
                                    <th colspan="2" width="200px">Actions</th>
                                    <th>Reason</th>
                                    <th>Created By</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <table>
                                            <tr><td>user-nonprod</td></tr>
                                            <tr><td>user-prod</td></tr>
                                        </table>
                                    <td>False</td>
                                    <td>
                                        <table>
                                            <tr>
                                                <td>type</td>
                                            </tr>
                                            <tr>
                                                <td>type</td>
                                            </tr>
                                            <tr>
                                                <td>signal</td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td>
                                        <table>
                                            <tr>
                                                <td>allow</td>
                                            </tr>
                                            <tr>
                                                <td>addSignal</td>
                                            </tr>
                                            <tr>
                                                <td>corp.dc-iad</td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td>Temporary Whitelist to allow from new IP Range for IAD DC. Expire if no traffic is coming out of it.</td>
                                    <td>reenan.arbitrario@hulu.com</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td>False</td>
                                    <td>
                                        type
                                    </td>
                                    <td>
                                        allow
                                    </td>
                                    <td>Whitelist Fastly IPs https://jira.hulu.com/browse/APPSEC-461</td>
                                    <td>reenan.arbitrario@hulu.com</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col"></div>
            </div>

            <div class="row nextsite">
                <div class="col"></div>
                <div class="col-6">
                    <h1>ads-nonprod Site</h1>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Top Attack Signals Over Past 30 Days</h2>
                    <p><img src="static/img/top-attack-signals-last-30-days.png" alt="count of attack signals for ads-nonprod" class="img-fluid" width="100%"/></p>
                    <p>Visibility is critical when organizations are dealing with malicious activity across their web applications. Layer 7 attacks such as app-level DDoS, API abuse, and account takeovers pose both security and resource-utilization risks for a company and its users: these attacks can cause excessive resource consumption and impact performance across applications. Top Attack Signals gives that visibility over the past 30 days to help you focus your security efforts.</p>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Sample of Site Events</h2>
                    <p>Events are actions that Signal Sciences takes as the result of regular threshold-based blocking, templated rules, and site alerts.</p>
                    <p><a href="">View Site Events</a></p>
                    <div>
                        <table class="table">
                            <caption>The rows colored red are RFC 1918 Private network addresses space.</caption>
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Country Code</th>
                                    <th>Reasons</th>
                                    <th>Path</th>
                                </tr>
                            </thead>  
                            <tbody> 
                                <tr>
                                    <td>202.61.224.64</td>
                                    <td>DE</td>
                                    <td>CMDEXE (58)</td>
                                    <td>/bin/wcm/search/gql.servlet.json</td>
                                </tr>
                                <tr>
                                    <td>164.92.212.217</td>
                                    <td>NL</td>
                                    <td>CMDEXE (53)</td>
                                    <td>/bin/wcm/search/gql.servlet.json<br/>a.css</td>
                                </tr>
                                <tr>
                                    <td>138.2.86.233</td>
                                    <td>SG</td>
                                    <td>CMDEXE (58)</td>
                                    <td>/bin/wcm/search/gql.json</td>
                                </tr>
                                <tr>
                                    <td>38.242.225.81</td>
                                    <td>DE</td>
                                    <td>CMDEXE (58)</td>
                                    <td>/bin/wcm/search/gql.servlet.json</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col"></div>
            </div>

            <div class="row">
                <div class="col"></div>
                <div class="col-6">
                    <h2>Sample of Suspicious IPs</h2>
                    <p>The Suspicious IPs tab shows IP addresses from which requests containing attack payloads have originated, but the volume of attack traffic from these IPs has not exceeded the decision threshold. Once the threshold is met or exceeded, an IP address will be flagged and added to the Flagged IPs list. The Suspicious IPs tab enables you to anticipate which IPs may soon be flagged.</p>
                    <p><a href="">View Suspicious IPs</a></p>
                    <div>
                        <table class="table">
                            <caption>The rows colored red are RFC 1918 Private network addresses space.</caption>
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Country Code</th>
                                    <th>Remote Hostname</th>
                                    <th>Signals</th>
                                </tr>
                            </thead>  
                            <tbody> 
                                <tr>
                                    <td>202.61.224.64</td>
                                    <td>DE</td>
                                    <td></td>
                                    <td>LOG4J-JNDI</td>
                                </tr>
                                <tr>
                                    <td>69.16.157.95</td>
                                    <td>IT</td>
                                    <td>69.16.157.95.mxp.as54203.net</td>
                                    <td>CMDEXE</td>
                                </tr>
                                <tr>
                                    <td>216.131.112.45</td>
                                    <td>NL</td>
                                    <td>216-131-112-45.ams.as62651.net</td>
                                    <td>CMDEXE</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col"></div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    </body>

</html>